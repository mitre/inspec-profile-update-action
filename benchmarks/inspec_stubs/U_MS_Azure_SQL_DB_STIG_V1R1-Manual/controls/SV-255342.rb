control 'SV-255342' do
  title 'Azure SQL Database must utilize centralized management of the content captured in audit records generated by all components of the DBMS.'
  desc 'Without the ability to centrally manage the content captured in the audit records, identification, troubleshooting, and correlation of suspicious behavior would be difficult and could lead to a delayed or incomplete analysis of an ongoing attack.

The content captured in audit records must be managed from a central location (necessitating automation). Centralized management of audit records and logs provides for efficiency in maintenance and management of records, as well as the backup and archiving of those records. 

Azure SQL Database may write audit records to database tables, to files in the file system, to other kinds of local repository, or directly to a centralized log management system. Whatever the method used, it must be compatible with offloading the records to the centralized system.'
  desc 'check', 'Review the system documentation for a description of how audit records are offloaded and how local audit log space is managed.  
 
From the Azure Portal Azure SQL Database page, select Auditing. Review the audit storage methods in use.

If Azure SQL Database audit records are not written directly to or systematically transferred to a centralized log management system, this is a finding.'
  desc 'fix', 'Configure Azure SQL Database audit records to be written directly to a centralized audit storage location.

https://docs.microsoft.com/en-us/azure/azure-sql/database/auditing-overview#audit-storage-destination

To configure writing audit logs to a storage account, select "Storage" in the "Auditing" section. 

Select the Azure storage account where logs will be saved, and then open Advanced properties to select the retention period.
 
Click "Save". 

Logs older than the retention period are deleted.'
  impact 0.5
  ref 'DPMS Target MS Azure SQL DB'
  tag check_id: 'C-59015r871150_chk'
  tag severity: 'medium'
  tag gid: 'V-255342'
  tag rid: 'SV-255342r871152_rule'
  tag stig_id: 'ASQL-00-010700'
  tag gtitle: 'SRG-APP-000356-DB-000314'
  tag fix_id: 'F-58959r871151_fix'
  tag 'documentable'
  tag cci: ['CCI-001844']
  tag nist: ['AU-3 (2)']
end
