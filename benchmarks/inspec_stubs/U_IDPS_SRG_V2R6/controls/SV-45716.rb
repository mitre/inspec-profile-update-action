control 'SV-45716' do
  title 'The IDPS must block outbound ICMP Destination Unreachable, Redirect, and Address Mask reply messages.'
  desc 'Internet Control Message Protocol (ICMP) messages are used to provide feedback about problems in the network. These messages are sent back to the sender to support diagnostics. However, some messages can also provide host information and network topology that may be exploited by an attacker.

An IDPS must be configured to "silently drop" the packet and not send an ICMP control message back to the source. In some cases, it may be necessary to direct the traffic to a null interface.

Three ICMP messages are commonly used by attackers for network mapping: Destination Unreachable, Redirect, and Address Mask Reply.

These responses must be blocked on external interfaces; however, blocking the Destination Unreachable response will prevent Path Maximum Transmission Unit Discovery (PMTUD), which relies on the response "ICMP Destination Unreachable--Fragmentation Needed but DF Bit Set". PMTUD is a useful function and should only be "broken" after careful consideration.

An acceptable alternative to blocking all Destination Unreachable responses is to filter Destination Unreachable messages generated by the IDPS to allow ICMP Destination Unreachable--Fragmentation Needed but DF Bit Set (Type 3, Code 4) and apply this filter to the external interfaces.'
  desc 'check', 'Verify the IDPS blocks outbound ICMP Destination Unreachable, Redirect, and Address Mask reply messages. 

If the IDPS does not block outbound ICMP Destination Unreachable, Redirect, and Address Mask reply messages, this is a finding.'
  desc 'fix', 'Configure the IDPS to block outbound ICMP Destination Unreachable, Redirect, and Address Mask reply messages. 

An acceptable alternative to blocking all Destination Unreachable responses is to filter Destination Unreachable messages generated by the firewall implementation to allow ICMP Destination Unreachable--
Fragmentation Needed but DF Bit Set (Type 3, Code 4) and apply this filter to the external interfaces.'
  impact 0.5
  ref 'DPMS Target SRG-NET-IDPS'
  tag check_id: 'C-43082r4_chk'
  tag severity: 'medium'
  tag gid: 'V-34788'
  tag rid: 'SV-45716r2_rule'
  tag stig_id: 'SRG-NET-000273-IDPS-00198'
  tag gtitle: 'SRG-NET-000273-IDPS-00198'
  tag fix_id: 'F-39114r2_fix'
  tag 'documentable'
  tag cci: ['CCI-001312']
  tag nist: ['SI-11 a']
end
