control 'SV-239739' do
  title 'VAMI configuration files must be protected from unauthorized access.'
  desc "Accounts on the VAMI server are to be kept to a minimum. Only administrators, web managers, developers, auditors, and web authors require accounts on the machine hosting the Lighttpd server. The resources to which these accounts have access must also be closely monitored and controlled. Only the system administrator needs access to all of the system's capabilities, while the web administrator and associated staff require access and control of the web content and the Lighttpd server configuration files."
  desc 'check', 'Note: The below command must be run from a bash shell and not from a shell generated by the "appliance shell". Use the "chsh" command to change the shell for the account to "/bin/bash".

At the command prompt, execute the following command:

# stat -c "%n permissions are %a and ownership is %U:%G" /opt/vmware/etc/lighttpd/lighttpd.conf /etc/applmgmt/appliance/lighttpd.conf

Expected result:

/opt/vmware/etc/lighttpd/lighttpd.conf permissions are 644 and ownership is root:root
/etc/applmgmt/appliance/lighttpd.conf permissions are 644 and ownership is root:root

If the output does not match the expected result, this is a finding.'
  desc 'fix', 'At the command prompt, enter the following command:

# chmod 644 <file>
# chown root:root <file>

Note: Replace <file> with every file returned from the command in the check.'
  impact 0.5
  ref 'DPMS Target VMware vSphere 6.7 VAMI-lighttpd'
  tag check_id: 'C-42972r816826_chk'
  tag severity: 'medium'
  tag gid: 'V-239739'
  tag rid: 'SV-239739r879753_rule'
  tag stig_id: 'VCLD-67-000032'
  tag gtitle: 'SRG-APP-000380-WSR-000072'
  tag fix_id: 'F-42931r679326_fix'
  tag 'documentable'
  tag cci: ['CCI-001813']
  tag nist: ['CM-5 (1) (a)']
end
