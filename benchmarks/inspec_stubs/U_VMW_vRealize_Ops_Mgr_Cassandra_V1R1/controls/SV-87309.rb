control 'SV-87309' do
  title 'The Cassandra Server must generate time stamps, for audit records and application data, with a minimum granularity of one second.'
  desc "Without sufficient granularity of time stamps, it is not possible to adequately determine the chronological order of records. 

Time stamps generated by the DBMS must include date and time. Granularity of time measurements refers to the precision available in time stamp values. Granularity coarser than one second is not sufficient for audit trail purposes. Time stamp values are typically presented with three or more decimal places of seconds; however, the actual granularity may be coarser than the apparent precision. For example, SQL Server's GETDATE()/CURRENT_TMESTAMP values are presented to three decimal places, but the granularity is not one millisecond: it is about 1/300 of a second.

Some DBMS products offer a data type called TIMESTAMP that is not a representation of date and time. Rather, it is a database state counter and does not correspond to calendar and clock time. This requirement does not refer to that meaning of TIMESTAMP."
  desc 'check', 'Review the Cassandra Server settings to ensure time stamps, for audit records and application data, with a minimum granularity of one second are generated.

Navigate to and open /usr/lib/vmware-vcops/user/conf/cassandra/logback.xml.

Navigate to the <appender> node with the name="FILE" attribute.

Navigate to <encoder> node.

If the <pattern> node does not look like the expected result, this is a finding.

Expected result:
<pattern>%-5level [%thread] %date{ISO8601, UTC} %F:%L - %msg%n</pattern>'
  desc 'fix', 'Configure the Cassandra Server to generate time stamps, for audit records and application data, with a minimum granularity of one second.

Navigate to and open /usr/lib/vmware-vcops/user/conf/cassandra/logback.xml.

Navigate to the <appender> node with the name="FILE" attribute.

Navigate to <encoder> node.

Edit the <pattern> to look like the below.
<pattern>%-5level [%thread] %date{ISO8601, UTC} %F:%L - %msg%n</pattern>'
  impact 0.5
  ref 'DPMS Target VMware Cassandra'
  tag check_id: 'C-72833r1_chk'
  tag severity: 'medium'
  tag gid: 'V-72677'
  tag rid: 'SV-87309r1_rule'
  tag stig_id: 'VROM-CS-000225'
  tag gtitle: 'SRG-APP-000375-DB-000323'
  tag fix_id: 'F-79081r1_fix'
  tag 'documentable'
  tag cci: ['CCI-001889']
  tag nist: ['AU-8 b']
end
