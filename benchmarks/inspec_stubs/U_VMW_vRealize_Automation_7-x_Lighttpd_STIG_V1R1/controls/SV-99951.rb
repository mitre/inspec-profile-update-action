control 'SV-99951' do
  title 'Lighttpd audit records must be mapped to a time stamp.'
  desc 'If time stamps are not consistently applied and there is no common time reference, it is difficult to perform forensic analysis across multiple devices and log records.

Time stamps generated by the web server include date and time. Time is commonly expressed in Coordinated Universal Time (UTC), a modern continuation of Greenwich Mean Time (GMT), or local time with an offset from UTC.

In order to ensure that Lighttpd is correctly logging timestamps, the accesslog.format setting must be enabled.'
  desc 'check', %q(At the command prompt, execute the following command:

grep 'accesslog.format' /opt/vmware/etc/lighttpd/lighttpd.conf | grep -v ^#

If no value is returned or if the "accesslog.format" is commented out, this is a finding.)
  desc 'fix', %q(Navigate to and open /opt/vmware/etc/lighttpd/lighttpd.conf

Note: If the accesslog.format setting was commented out with a '#' sign, remove the '#' sign.

Configure the lighttpd.conf file with the following: 

accesslog.format = "%h %l %u %t \"%r\" %b %>s \"%{User-Agent}i\" \"%{Referer}i\"")
  impact 0.5
  ref 'DPMS Target VMware vRealize Automation 7.x Lighttpd'
  tag check_id: 'C-88993r1_chk'
  tag severity: 'medium'
  tag gid: 'V-89301'
  tag rid: 'SV-99951r1_rule'
  tag stig_id: 'VRAU-LI-000415'
  tag gtitle: 'SRG-APP-000374-WSR-000172'
  tag fix_id: 'F-96043r1_fix'
  tag 'documentable'
  tag cci: ['CCI-001890']
  tag nist: ['AU-8 b']
end
