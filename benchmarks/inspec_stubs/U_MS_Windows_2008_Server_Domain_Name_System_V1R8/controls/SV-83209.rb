control 'SV-83209' do
  title 'The Windows DNS Server key file must be owned by the account under which the Windows  DNS Server service is run.'
  desc 'To enable dnssec (requests and responses) through authenticated messages, it is necessary to generate a key for every pair of name servers. The key can also be used for securing other transactions, such as dynamic updates, DNS queries, and responses. The binary key string that is generated by the dnscmd key generation utility used with DNSSEC is Base64-encoded.'
  desc 'check', "Access Services on the Windows DNS Server and locate the DNS Server Service.

Determine the account under which the DNS Server Service is running. 

Access Windows Explorer.

Navigate to the following location:

%ALLUSERSPROFILE%\\Microsoft\\Crypto
Note: If the %ALLUSERSPROFILE%\\Microsoft\\Crypto folder doesn't exist, this is not applicable.

Right-click on each sub-folder, choose “Properties”, click on the “Security” tab, and click on the “Advanced” button.

Verify the Owner on the folder, sub-folders, and files are the account under which the DNS Server Service is running.

If any other user or group is listed as OWNER of the %ALLUSERSPROFILE%\\Microsoft\\Crypto folder, sub-folders, and files, this is a finding."
  desc 'fix', 'Access Windows Explorer.

Navigate to the following location:

%ALLUSERSPROFILE%\\Microsoft\\Crypto

Right-click on each sub-folder, choose “Properties”, click on the “Security” tab, and click on the “Advanced” button.

Click on "Change" next to the listed Owner and change to be the account under which the DNS Server Service is running.'
  impact 0.5
  ref 'DPMS Target Windows 2008 DNS'
  ref 'DPMS Target Windows 2008 R2 DNS'
  tag check_id: 'C-59515r5_chk'
  tag severity: 'medium'
  tag gid: 'V-58643'
  tag rid: 'SV-83209r2_rule'
  tag stig_id: 'WDNS-IA-000007'
  tag gtitle: 'SRG-APP-000176-DNS-000018'
  tag fix_id: 'F-64027r5_fix'
  tag 'documentable'
  tag cci: ['CCI-000186']
  tag nist: ['IA-5 (2) (a) (1)']
end
