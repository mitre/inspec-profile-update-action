control 'SV-240851' do
  title 'tc Server HORIZON must record time stamps for log records to a minimum granularity of one second.'
  desc 'Without sufficient granularity of time stamps, it is not possible to adequately determine the chronological order of records. 

Time stamps generated by the web server include date and time and must be to a granularity of one second.

Like all web servers, tc Server logs can be configured to produce a Common Log Format (CLF). The tc Server component known as an AccessLogValve, which represents a component that can be inserted into the request processing pipeline to capture user interaction. The Access Log Valve should be configured to ensure that investigators have sufficient information to conduct an appropriate audit.'
  desc 'check', 'At the command prompt, execute the following command:

tail /storage/log/vmware/horizon/localhost_access_log.YYYY-MM-dd.txt

If the timestamp does not contain a minimum granularity of one second, this is a finding.

Note: Substitute the actual date in the file name.

Note: In Common Log Format, a timestamp will look like [06/Feb/2016:23:12:57 +0000]. The "57" part is the "seconds" part of the timestamp.'
  desc 'fix', %q(Navigate to and open /opt/vmware/horizon/workspace/conf/server.xml.

Navigate to the <Valve className="org.apache.catalina.valves.AccessLogValve"> node.

Set the 'pattern' setting with "%h %l %u %t &quot;%r&quot; %s %b".

Note: The <Valve> node should be configured per the following:

                <Valve className="org.apache.catalina.valves.AccessLogValve"
                       directory="logs"
                       pattern="%h %l %u %t &quot;%r&quot; %s %b"
                       prefix="localhost_access_log."
                       suffix=".txt"/>)
  impact 0.5
  ref 'DPMS Target VMware vRealize Automation 7-x tc Server'
  tag check_id: 'C-44084r674449_chk'
  tag severity: 'medium'
  tag gid: 'V-240851'
  tag rid: 'SV-240851r674450_rule'
  tag stig_id: 'VRAU-TC-000775'
  tag gtitle: 'SRG-APP-000375-WSR-000171'
  tag fix_id: 'F-44043r674296_fix'
  tag 'documentable'
  tag legacy: ['SV-100781', 'V-90131']
  tag cci: ['CCI-001889']
  tag nist: ['AU-8 b']
end
