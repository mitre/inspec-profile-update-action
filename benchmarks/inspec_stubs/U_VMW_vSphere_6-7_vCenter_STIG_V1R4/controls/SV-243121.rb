control 'SV-243121' do
  title 'The vCenter Server must have new Key Encryption Keys (KEKs) reissued at regular intervals for vSAN encrypted datastore(s).'
  desc 'The KEK for a vSAN encrypted datastore is generated by the Key Management Server (KMS) and serves as a wrapper and lock around the Disk Encryption Key (DEK). The DEK is generated by the host and is used to encrypt and decrypt the datastore.

A mustow rekey is a procedure in which the KMS issues a new KEK to the ESXi host that rewraps the DEK but does not change the DEK or any data on disk. This operation must be done on a regular, site-defined interval and can be viewed as similar in criticality to changing an administrative password. 

If the KMS is compromised, a standing operational procedure to rekey will put a time limit on the usefulness of any stolen KMS data.'
  desc 'check', 'Interview the SA to determine that a procedure has been implemented to perform a mustow rekey of all vSAN encrypted datastores at regular, site-defined intervals.

VMware recommends a 60-day rekey task, but this interval must be defined by the SA and the ISSO.

If vSAN encryption is not in use, this is not a finding.'
  desc 'fix', 'If vSAN encryption is in use, ensure that a regular rekey procedure is in place.'
  impact 0.5
  ref 'DPMS Target VMware vSphere 6.7 vCenter'
  tag check_id: 'C-46396r719604_chk'
  tag severity: 'medium'
  tag gid: 'V-243121'
  tag rid: 'SV-243121r879887_rule'
  tag stig_id: 'VCTR-67-000066'
  tag gtitle: 'SRG-APP-000516'
  tag fix_id: 'F-46353r719605_fix'
  tag 'documentable'
  tag cci: ['CCI-000366']
  tag nist: ['CM-6 b']
end
