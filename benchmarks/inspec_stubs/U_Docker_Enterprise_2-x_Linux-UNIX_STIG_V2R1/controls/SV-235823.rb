control 'SV-235823' do
  title 'Docker Enterprise Swarm manager must be run in auto-lock mode.'
  desc "Run Docker swarm manager in auto-lock mode.

When Docker restarts, both the TLS key used to encrypt communication among swarm nodes, and the key used to encrypt and decrypt Raft logs on disk, are loaded into each manager node's memory. Protect the mutual TLS encryption key and the key used to encrypt and decrypt Raft logs at rest. This protection could be enabled by initializing swarm with --autolock flag.

With --autolock enabled, when Docker restarts, unlock the swarm first, using a key encryption key generated by Docker when the swarm was initialized."
  desc 'check', 'Ensure swarm manager is run in auto-lock mode.

via CLI:

Linux: As a Docker EE Admin, follow the steps below using a Universal Control Plane (UCP) client bundle:

Run the below command. If it outputs the key, it means swarm was initialized with the --autolock flag.

docker swarm unlock-key

If the output is no unlock key is set, it means that swarm was NOT initialized with the --autolock flag and this is a finding.'
  desc 'fix', 'If initializing swarm, use the below command.

docker swarm init --autolock
If setting --autolock on an existing swarm manager node, use the below command.

docker swarm update --autolock'
  impact 0.5
  ref 'DPMS Target Docker Enterprise 2-x Linux-UNIX'
  tag check_id: 'C-39042r627594_chk'
  tag severity: 'medium'
  tag gid: 'V-235823'
  tag rid: 'SV-235823r627596_rule'
  tag stig_id: 'DKER-EE-002400'
  tag gtitle: 'SRG-APP-000176'
  tag fix_id: 'F-39005r627595_fix'
  tag 'documentable'
  tag legacy: ['SV-105141', 'V-96003']
  tag cci: ['CCI-000186']
  tag nist: ['IA-5 (2) (a) (1)']
end
