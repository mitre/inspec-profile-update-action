control 'SV-216683' do
  title 'The Cisco router must be configured to only permit management traffic that ingresses and egresses the out-of-band management (OOBM) interface.'
  desc 'The OOBM access switch will connect to the management interface of the managed network elements. The management interface can be a true OOBM interface or a standard interface functioning as the management interface. In either case, the management interface of the managed network element will be directly connected to the OOBM network.

An OOBM interface does not forward transit traffic, thereby providing complete separation of production and management traffic. Since all management traffic is immediately forwarded into the management network, it is not exposed to possible tampering. The separation also ensures that congestion or failures in the managed network do not affect the management of the device. If the device does not have an OOBM port, the interface functioning as the management interface must be configured so that management traffic does not leak into the managed network and that production traffic does not leak into the management network.'
  desc 'check', 'This requirement is only applicable where management access to the router is via an OOBM interface which is not a true OOBM interface.

Step 1: Verify that the managed interface has an inbound and outbound ACL configured. 

interface GigabitEthernet0/7
 description link to OOBM access switch
 ip address 10.11.1.22 255.255.255.0
 ip access-group INGRESS_MANAGEMENT_ACL in
 ip access-group EGRESS_MANAGEMENT_ACL out

Step 2: Verify that the ingress ACL only allows management and ICMP traffic. 

ip access-list extended INGRESS_MANAGEMENT_ACL
 permit tcp any host 10.11.1.22 eq tacacs
 permit tcp any host 10.11.1.22 eq 22
 permit udp any host 10.11.1.22 eq snmp
 permit udp any host 10.11.1.22 eq snmptrap
 permit udp any host 10.11.1.22 eq ntp
 permit icmp any host 10.11.1.22
 deny   ip any any log-input

Step 3: Verify that the egress ACL blocks any transit traffic.

ip access-list extended EGRESS_MANAGEMENT_ACL
 deny   ip any any log-input

Note: On Cisco routers, local generated packets are not inspected by outgoing interface access-lists. Hence, the above configuration would simply drop any packets not generated by the router; hence, blocking any transit traffic.

If the router does not restrict traffic that ingresses and egresses the management interface, this is a finding.'
  desc 'fix', 'If the management interface is not a dedicated OOBM interface, it must be configured with both an ingress and egress ACL.

Step 1: Configure an ingress ACL a shown in the example below:

R5(config)#ip access-list extended INGRESS_MANAGEMENT_ACL
R5(config-ext-nacl)#permit tcp any host 10.11.1.22 eq tacacs
R5(config-ext-nacl)#permit tcp any host 10.11.1.22 eq 22
R5(config-ext-nacl)#permit udp any host 10.11.1.22 eq snmp
R5(config-ext-nacl)#permit udp any host 10.11.1.22 eq snmptrap
R5(config-ext-nacl)#permit udp any host 10.11.1.22 eq ntp
R5(config-ext-nacl)#permit icmp any host 10.11.1.22
R5(config-ext-nacl)#deny ip any any log-input
R5(config-ext-nacl)#exit

Step 2: Configure an egress ACL a shown in the example below:

R5(config)#ip access-list extended EGRESS_MANAGEMENT_ACL
R5(config-ext-nacl)#deny ip any any log-input
R5(config-ext-nacl)#exit

Step 3: Apply the ACLs to the OOBM interfaces.

R4(config)#int g0/7
R4(config-if)#ip access-group INGRESS_MANAGEMENT_ACL in
R4(config-if)#ip access-group EGRESS_MANAGEMENT_ACL out'
  impact 0.5
  ref 'DPMS Target Cisco IOS XE Router RTR'
  tag check_id: 'C-17916r288000_chk'
  tag severity: 'medium'
  tag gid: 'V-216683'
  tag rid: 'SV-216683r531086_rule'
  tag stig_id: 'CISC-RT-000450'
  tag gtitle: 'SRG-NET-000205-RTR-000012'
  tag fix_id: 'F-17914r288001_fix'
  tag 'documentable'
  tag legacy: ['SV-106077', 'V-96939']
  tag cci: ['CCI-001097']
  tag nist: ['SC-7 a']
end
