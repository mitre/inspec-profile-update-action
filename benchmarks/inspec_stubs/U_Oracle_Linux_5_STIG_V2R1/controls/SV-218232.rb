control 'SV-218232' do
  title 'Global settings defined in system-auth must be applied in the pam.d definition files.'
  desc "Pam global requirements are generally defined in the /etc/pam.d/system-auth or /etc/pam.d/system-auth-ac file. In order for the requirements to be applied the file containing them must be included directly or indirectly in each program's definition file in /etc/pam.d"
  desc 'check', 'Verify the system-auth settings are being applied.

Procedure:
Verify the additional pam.d requirements are in use.

The file "/etc/pam.d/system-auth-ac" is auto generated by "authconfig". Any manual changes made to it will be lost next time "authconfig" is run. 
Check to see if the systems default of the symlink "/etc/pam.d/system-auth" pointing to "/etc/pam.d/system-auth-ac" has been changed.

# ls -l /etc/pam.d/system-auth

If the symlink points to "/etc/pam.d/system-auth-ac", manual changes cannot be protected. This is a finding.

# grep system-auth-ac /etc/pam.d/system-auth

The local system-auth file pointed to by "/etc/pam.d/system-auth" must contain "/etc/pam.d/system-auth-ac" for the auth, account, password, and session lines. 

If it does not then the parameters maintained by "authconfig" will not be applied, this is a finding.'
  desc 'fix', %q(By default, the operating system delivers /etc/pam.d/system-auth as a symbolic link to /etc/pam.d/system-auth-ac (an automatically generated file).  When a site adds password requirements a new system-auth-local file must be created with only the additional requirements and includes for auth, account, passwd and session pointing to "/etc/pam.d/system-auth-ac". Then the symlink "/etc/system-auth" is modified to point to "/etc/pam.d/system-auth-local". This way any changes made do not get lost when "/etc/pam.d/system-auth-ac" is regenerated and each program's pam.d definition file need only have "include system-auth" for auth, account, passwd and session, as needed, in order to assure the password requirements will be applied to it.)
  impact 0.5
  ref 'DPMS Target Oracle Linux 5'
  tag check_id: 'C-19707r568657_chk'
  tag severity: 'medium'
  tag gid: 'V-218232'
  tag rid: 'SV-218232r603259_rule'
  tag stig_id: 'GEN000600-2'
  tag gtitle: 'SRG-OS-000069-GPOS-00037'
  tag fix_id: 'F-19705r568658_fix'
  tag 'documentable'
  tag legacy: ['V-27285', 'SV-63987']
  tag cci: ['CCI-000192']
  tag nist: ['IA-5 (1) (a)']
end
