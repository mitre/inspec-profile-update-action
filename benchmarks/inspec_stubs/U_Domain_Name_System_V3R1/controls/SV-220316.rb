control 'SV-220316' do
  title 'A unique TSIG key must be generated for each pair of communicating hosts.'
  desc 'To enable zone transfer (requests and responses) through authenticated messages, it is necessary to generate a key for every pair of name servers. The key also can be used for securing other transactions, such as dynamic updates, DNS queries, and responses. The binary key string that is generated by most key generation utilities used with DNSSEC is Base64-encoded. TSIG is a string used to generate the message authentication hash stored in a TSIG RR and used to authenticate an entire DNS message.

The process of authenticating the source of a message and its integrity through hash-based message authentication codes (HMAC) is specified through a set of DNS specifications known collectively as TSIG. The sender of the message uses the HMAC function to generate a MAC and sends this MAC along with the message to the receiver. The receiver, who shares the same secret key, uses the key and HMAC function used by the sender to compute the MAC on the received message. The receiver then compares the computed MAC with the received MAC; if the two values match, it provides assurance that the message has been received correctly and that the sender belongs to the community of users sharing the same secret key. Thus, message source authentication and integrity verification are performed in a single process. To enable zone transfer (requests and responses) through authenticated messages, it is necessary to generate a key for every pair of name servers. The key also can be used for securing other transactions, such as dynamic updates, DNS queries, and responses. The binary key string that is generated by most key generation utilities used with DNSSEC is Base64-encoded. TSIG is a string used to generate the message authentication hash stored in a TSIG RR and used to authenticate an entire DNS message.'
  desc 'check', 'Review the DNS implementation. Verify that each pair of communicating hosts has a unique TSIG key (i.e., a separate key for each secondary name server to authenticate transactions with the primary name server, etc.)

If a unique TSIG key has not been generated for each pair of communicating hosts, this is a finding.'
  desc 'fix', 'Regenerate a unique TSIG key for each pair of communicating hosts within the DNS architecture.'
  impact 0.5
  ref 'DPMS Target DNS'
  tag check_id: 'C-22031r392381_chk'
  tag severity: 'medium'
  tag gid: 'V-220316'
  tag rid: 'SV-220316r918504_rule'
  tag stig_id: 'SRG-APP-000176-DNS-000076'
  tag gtitle: 'SRG-APP-000516'
  tag fix_id: 'F-22023r392382_fix'
  tag 'documentable'
  tag legacy: ['SV-69053', 'V-54807']
  tag cci: ['CCI-000186']
  tag nist: ['IA-5 (2) (a) (1)']
end
