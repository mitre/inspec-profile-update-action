control 'SV-100779' do
  title 'tc Server VCAC must generate log records that can be mapped to Coordinated Universal Time (UTC) or Greenwich Mean Time (GMT).'
  desc 'If time stamps are not consistently applied and there is no common time reference, it is difficult to perform forensic analysis across multiple devices and log records.

Time stamps generated by the web server include date and time. Time is commonly expressed in Coordinated Universal Time (UTC), a modern continuation of Greenwich Mean Time (GMT), or local time with an offset from UTC.

Like all web servers, tc Server logs can be configured to produce a Common Log Format (CLF). The tc Server component known as an AccessLogValve, which represents a component that can be inserted into the request processing pipeline to capture user interaction. The Access Log Valve creates log files in the same format as those created by standard web servers including GMT offset.'
  desc 'check', 'At the command prompt, execute the following command: 

tail /storage/log/vmware/vcac/access_log.YYYY-MM-dd.txt

If the timestamp does not contain a time zone mapping, this is a finding.

Note: Substitute the actual date in the file name.

Note: In Common Log Format, a timestamp will look like [06/Feb/2016:23:12:57 +0000]. The +0000 part is the time zone mapping.'
  desc 'fix', 'Navigate to and open /etc/vcac/server.xml.

Navigate to the <Valve className="org.apache.catalina.valves.AccessLogValve"> node.

Set the "pattern" setting with "%h %l %u %t &quot;%r&quot; %s %b".

Note: The <Valve> node should be configured per the following:

                <Valve className="org.apache.catalina.valves.AccessLogValve"
                       checkExists="true" 
                       directory="logs"
                       pattern="%h %l %u %t &quot;%r&quot; %s %b"
                       prefix="access_log"
                       requestAttributesEnabled="true"
                       rotatable="false"
                       suffix=".txt"/>'
  impact 0.5
  ref 'DPMS Target VMware vRealize Automation 7.x tcServer'
  tag check_id: 'C-89821r1_chk'
  tag severity: 'medium'
  tag gid: 'V-90129'
  tag rid: 'SV-100779r1_rule'
  tag stig_id: 'VRAU-TC-000770'
  tag gtitle: 'SRG-APP-000374-WSR-000172'
  tag fix_id: 'F-96871r1_fix'
  tag 'documentable'
  tag cci: ['CCI-001890']
  tag nist: ['AU-8 b']
end
