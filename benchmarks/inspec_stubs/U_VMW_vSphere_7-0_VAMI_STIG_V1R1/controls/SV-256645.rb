control 'SV-256645' do
  title 'VAMI must limit the number of simultaneous requests.'
  desc '<0> [object Object]'
  desc 'check', %q(At the command prompt, run the following command:

# /opt/vmware/sbin/vami-lighttpd -p -f /opt/vmware/etc/lighttpd/lighttpd.conf 2>/dev/null |grep "server.max-connections"|sed -e 's/^[ ]*//'

Expected result:

server.max-connections = 1024

If the output does not match the expected result, this is a finding.

Note: The command must be run from a bash shell and not from a shell generated by the "appliance shell". Use the "chsh" command to change the shell for the account to "/bin/bash". Refer to KB Article 2100508 for more details:

https://kb.vmware.com/s/article/2100508)
  desc 'fix', 'Navigate to and open:

/opt/vmware/etc/lighttpd/lighttpd.conf 

Add or reconfigure the following value:

server.max-connections = 1024

Restart the service with the following command:

# vmon-cli --restart applmgmt'
  impact 0.5
  ref 'DPMS Target VMware vSphere 7.0 VAMI STIG'
  tag check_id: 'C-60320r888455_chk'
  tag severity: 'medium'
  tag gid: 'V-256645'
  tag rid: 'SV-256645r888457_rule'
  tag stig_id: 'VCLD-70-000001'
  tag gtitle: 'SRG-APP-000001-WSR-000001'
  tag fix_id: 'F-60263r888456_fix'
  tag cci: ['CCI-000054']
  tag nist: ['AC-10']
end
